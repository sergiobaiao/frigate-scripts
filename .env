#!/bin/bash
# VERSION: 1.7
# =============================================================================
# FRIGATE NVR - CONFIGURAÇÃO CENTRALIZADA
# =============================================================================
# Este arquivo contém todas as variáveis de configuração utilizadas pelos
# scripts de gerenciamento de mídia do Frigate NVR.
#
# INSTRUÇÕES:
# 1. Copie este arquivo para .env.local para customizações locais
# 2. Ajuste os valores conforme sua instalação
# 3. Não commite .env.local no repositório
# =============================================================================
# -----------------------------------------------------------------------------
# TIMEZONE
# -----------------------------------------------------------------------------
# Fuso horário para logs e cálculos de data
export TZ="America/Fortaleza"
# -----------------------------------------------------------------------------
# CAMINHOS DE ARMAZENAMENTO
# -----------------------------------------------------------------------------
# SSD Principal (mountpoint do disco rápido)
SSD_ROOT="/mnt/frigate-ssd"
SSD_RECORDINGS="${SSD_ROOT}/frigate/recordings"
SSD_CLIPS="${SSD_ROOT}/frigate/clips"
SSD_EXPORTS="${SSD_ROOT}/frigate/exports"
SSD_SNAPSHOTS="${SSD_ROOT}/frigate/snapshots"
# HD Externo (mountpoint do disco de longo prazo)
HD_MOUNT="/mnt/hdexterno"
HD_RECORDINGS="${HD_MOUNT}/frigate/recordings"
HD_CLIPS="${HD_MOUNT}/frigate/clips"
HD_EXPORTS="${HD_MOUNT}/frigate/exports"
HD_SNAPSHOTS="${HD_MOUNT}/frigate/snapshots"
# -----------------------------------------------------------------------------
# CAMINHOS DE LOGS
# -----------------------------------------------------------------------------
LOG_DIR="/var/log"
LOG_ARCHIVE="${LOG_DIR}/frigate-archive.log"
LOG_PRUNE="${LOG_DIR}/frigate-prune-hd.log"
LOG_RETENTION="${LOG_DIR}/frigate-retention.log"
LOG_MOVER="${LOG_DIR}/ssd_to_hd.log"
LOG_VACUUM="${LOG_DIR}/frigate-vacuum.log"
LOG_STATUS="${LOG_DIR}/frigate-status.log"
LOG_CHECK="${LOG_DIR}/frigate-check.log"
LOG_RESET="${LOG_DIR}/frigate-reset.log"
LOG_USB_RESET="${LOG_DIR}/frigate-usb-reset.log"
# -----------------------------------------------------------------------------
# CAMINHOS DE LOCK FILES
# -----------------------------------------------------------------------------
# Lock files previnem execuções simultâneas dos scripts
LOCK_DIR="/var/lock"
LOCK_STORAGE="${LOCK_DIR}/frigate-storage.lock"
LOCK_MEDIA="${LOCK_DIR}/frigate-media.lock"
LOCK_MOVER="/tmp/mover_frigate.lock"
# -----------------------------------------------------------------------------
# POLÍTICAS DE RETENÇÃO
# -----------------------------------------------------------------------------
# Quantos dias manter gravações no SSD antes de mover para HD
KEEP_SSD_DAYS=1
# Quantos dias manter clips antes de deletar
CLIPS_KEEP_DAYS=1
# Quantos dias manter snapshots antes de deletar
SNAPSHOTS_KEEP_DAYS=1
# Quantos dias manter exports antes de deletar
EXPORTS_KEEP_DAYS=30
# Dias protegidos contra limpeza automática (vacuum)
PROTECT_DAYS=3
# -----------------------------------------------------------------------------
# ROTAÇÃO DE LOGS
# -----------------------------------------------------------------------------
# Quantos dias manter arquivos de log antes de remover
LOG_RETENTION_DAYS=30
# -----------------------------------------------------------------------------
# LIMITES DE USO DE DISCO
# -----------------------------------------------------------------------------
# Porcentagem mínima de espaço livre no HD (prune até atingir)
MIN_FREE_PCT=15
# Porcentagem máxima de uso do HD (vacuum quando ultrapassar)
HD_USAGE_THRESHOLD=90
# Porcentagem de uso do SSD que dispara movimentação de emergência
SSD_EMERGENCY_THRESHOLD=85
# -----------------------------------------------------------------------------
# CONFIGURAÇÕES DE TRANSFERÊNCIA
# -----------------------------------------------------------------------------
# Limite de banda para rsync (KB/s) - 0 = sem limite
# 20000 = ~20MB/s, bom para não sobrecarregar o sistema
BWLIMIT=20000
# Máximo de dias para processar por execução do archive
MAX_DAYS_PER_RUN=30
# Modo dry-run (1 = simula, 0 = executa de verdade)
DRY_RUN="${DRY_RUN:-0}"
# -----------------------------------------------------------------------------
# DISPOSITIVO USB (para reset)
# -----------------------------------------------------------------------------
# ID do dispositivo USB do HD externo (lsusb para descobrir)
USB_DEVICE_ID="174c:1153"
# -----------------------------------------------------------------------------
# NOTIFICAÇÕES (OPCIONAL)
# -----------------------------------------------------------------------------
# Comando opcional executado quando houver erro:
# Deve aceitar: <severity> <tag> <mensagem>
# Exemplo: NOTIFY_CMD="/usr/local/bin/frigate-notify"
NOTIFY_CMD=""
# -----------------------------------------------------------------------------
# USUÁRIO DO FRIGATE
# -----------------------------------------------------------------------------
# UID:GID do usuário que roda o Frigate (para chown dos arquivos)
FRIGATE_UID=1000
FRIGATE_GID=1000
# -----------------------------------------------------------------------------
# CONFIGURAÇÃO DO CONTAINER FRIGATE
# -----------------------------------------------------------------------------
# Caminho do diretório de configuração do Frigate (onde fica o frigate.db)
FRIGATE_CONFIG="/home/castro/marquise/config/frigate"
# Nome do container Docker do Frigate
FRIGATE_CONTAINER="frigate"
