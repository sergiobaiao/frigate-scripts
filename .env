#!/bin/bash
# =============================================================================
# FRIGATE NVR - CONFIGURAÇÃO CENTRALIZADA
# =============================================================================
# Este arquivo contém todas as variáveis de configuração utilizadas pelos
# scripts de gerenciamento de mídia do Frigate NVR.
#
# INSTRUÇÕES:
# 1. Copie este arquivo para .env.local para customizações locais
# 2. Ajuste os valores conforme sua instalação
# 3. Não commite .env.local no repositório
# =============================================================================

# -----------------------------------------------------------------------------
# TIMEZONE
# -----------------------------------------------------------------------------
# Fuso horário para logs e cálculos de data
export TZ="America/Fortaleza"

# -----------------------------------------------------------------------------
# CAMINHOS DE ARMAZENAMENTO
# -----------------------------------------------------------------------------

# SSD Principal (armazenamento rápido do Frigate)
SSD_ROOT="/mnt/frigate-ssd"
SSD_RECORDINGS="${SSD_ROOT}/recordings"
SSD_CLIPS="${SSD_ROOT}/clips"

# HD Externo (armazenamento de longo prazo)
HD_MOUNT="/mnt/hdexterno"
HD_RECORDINGS="${HD_MOUNT}/recordings"
HD_CLIPS="${HD_MOUNT}/clips"

# -----------------------------------------------------------------------------
# CAMINHOS DE LOGS
# -----------------------------------------------------------------------------
LOG_DIR="/var/log"
LOG_ARCHIVE="${LOG_DIR}/frigate-archive.log"
LOG_PRUNE="${LOG_DIR}/frigate-prune-hd.log"
LOG_RETENTION="${LOG_DIR}/frigate-retention.log"
LOG_MOVER="${LOG_DIR}/ssd_to_hd.log"

# -----------------------------------------------------------------------------
# CAMINHOS DE LOCK FILES
# -----------------------------------------------------------------------------
# Lock files previnem execuções simultâneas dos scripts
LOCK_DIR="/var/lock"
LOCK_STORAGE="${LOCK_DIR}/frigate-storage.lock"
LOCK_MEDIA="${LOCK_DIR}/frigate-media.lock"
LOCK_MOVER="/tmp/mover_frigate.lock"

# -----------------------------------------------------------------------------
# POLÍTICAS DE RETENÇÃO
# -----------------------------------------------------------------------------

# Quantos dias manter gravações no SSD antes de mover para HD
KEEP_SSD_DAYS=2

# Quantos dias manter clips antes de deletar
CLIPS_KEEP_DAYS=2

# Dias protegidos contra limpeza automática (vacuum)
PROTECT_DAYS=3

# -----------------------------------------------------------------------------
# ROTAÇÃO DE LOGS
# -----------------------------------------------------------------------------
# Quantos dias manter arquivos de log antes de remover
LOG_RETENTION_DAYS=30

# -----------------------------------------------------------------------------
# LIMITES DE USO DE DISCO
# -----------------------------------------------------------------------------

# Porcentagem mínima de espaço livre no HD (prune até atingir)
MIN_FREE_PCT=15

# Porcentagem máxima de uso do HD (vacuum quando ultrapassar)
HD_USAGE_THRESHOLD=90

# Porcentagem de uso do SSD que dispara movimentação de emergência
SSD_EMERGENCY_THRESHOLD=85

# -----------------------------------------------------------------------------
# CONFIGURAÇÕES DE TRANSFERÊNCIA
# -----------------------------------------------------------------------------

# Limite de banda para rsync (KB/s) - 0 = sem limite
# 20000 = ~20MB/s, bom para não sobrecarregar o sistema
BWLIMIT=20000

# Máximo de dias para processar por execução do archive
MAX_DAYS_PER_RUN=30

# Modo dry-run (1 = simula, 0 = executa de verdade)
DRY_RUN=0

# -----------------------------------------------------------------------------
# DISPOSITIVO USB (para reset)
# -----------------------------------------------------------------------------
# ID do dispositivo USB do HD externo (lsusb para descobrir)
USB_DEVICE_ID="174c:1153"

# -----------------------------------------------------------------------------
# USUÁRIO DO FRIGATE
# -----------------------------------------------------------------------------
# UID:GID do usuário que roda o Frigate (para chown dos arquivos)
FRIGATE_UID=1000
FRIGATE_GID=1000

# -----------------------------------------------------------------------------
# CONFIGURAÇÃO DO CONTAINER FRIGATE
# -----------------------------------------------------------------------------
# Caminho do diretório de configuração do Frigate (onde fica o frigate.db)
FRIGATE_CONFIG="/home/castro/marquise/config/frigate"

# Nome do container Docker do Frigate
FRIGATE_CONTAINER="frigate"
